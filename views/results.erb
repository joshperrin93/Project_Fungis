
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Fungis</title>
<link rel="stylesheet" href="/style.css">
</head>


<body>

<h1>Search results</h1>
<table>
  <% @sorted_restaurants.each do |restaurant| %>
    <tr>
      <td><%=restaurant[0]%></td>
      <td><%=restaurant[1]%></td>
      <td><%=restaurant[2]%></td>
      <td><img alt=<%=restaurant[0]%> src=<%=restaurant[3][0].fetch_url(800)%>
         width=150" height="70"></td>
      <td><form action="/index/<%=restaurant[4]%>" method="GET">
        <input type="submit" value="More info">
      </form></td>
    </tr>
  <% end %>
</table>

<div id="map"></div>
<script async
src="https://maps.googleapis.com/maps/api/js?key=<%=$api_key%>&callback=initMap">
</script>


<script>

function initMap() {

const london = {lat: 51.5048069497465, lng: -0.12909098341433795}
map = new google.maps.Map(document.getElementById('map'), {
center: london,
zoom: 8,
mapId: 'ca5dec382f52fe24'
});

// const marker = new google.maps.Marker({
//   position: london,
//   map: map,
// });
// }

const lng_lat = []

// function coordinates() {
//   @sorted_restaurants.map(restaurant => {
//     markers.push({lat: restaurant[5], lng: restaurant[6]})
//   })
// };

// let markers = <%=@coordinates%>
<% @coordinates.each do |lat, lng| %>
  lng_lat.push({lat: <%=lat%>, lng: <%=lng%>})
<%end%>

lng_lat.forEach(marker => {
  marker = new google.maps.Marker({
  position: marker,
  map: map,
});
})
}

</script>

</body>

</html>